# 契約管理APP 要件定義書

最終更新: 2025-10-05 (JST)
作成者: 村松亮、ChatGPT、Claude Code

**更新履歴:**
- 2025-10-05: UIモックアップに基づく画面構成・UI/UX要件の詳細化
- 2025-08-11: 初版作成

---

## 1. 目的・スコープ
- **フェーズ1対象**: 不動産関連の**賃貸借契約書・更新合意書・覚書**のPDFから、OCRおよびLLMを活用して**契約情報・物件情報・当事者情報・金銭条件**を構造化データとして抽出する。
- 抽出データは**検索・照会・更新・期限管理**に利用できるよう整備する。
- 自然言語検索(RAG)や要約機能により、契約情報の活用度を高める。
- 紙や従来のExcel台帳を置き換え、**期限アラート**や**証跡管理**を実現する。
- **フェーズ1の範囲外**: 重要事項説明書・稟議書処理、電子署名ワークフロー、会計仕訳自動化、eKYC
- **将来フェーズでの拡張予定**: 重要事項説明書・解約通知・見積請求書への対応

## 2. 想定ユーザー & ユースケース

### 2.1 対象事業者
- **不動産売買・仲介事業者**: 顧客の売買・賃貸契約を管理する不動産会社
- **不動産管理事業者**: 賃貸物件の管理を受託するプロパティマネジメント会社
- **多店舗展開事業者**: チェーン店・フランチャイズ等で複数テナント契約を持つ事業者
- **大手法人**: 複数拠点のオフィス・店舗賃貸契約を管理する企業

### 2.2 実際の利用者
- **事務担当者**: 日常的な契約データ入力・確認・更新業務を行う実務者
- **マネージャー・管理者**: 契約全体の把握・期限管理・意思決定を行う管理職
- **経理担当者**: 賃料・敷金等の金銭条件確認・会計処理を行う担当者

**主要ユースケース**:
1. PDFアップロード→自動抽出→担当者による検証→データベース反映
2. 満了・更新・解約など重要期限の自動アラート(メール)
3. 自然言語クエリによる契約検索(例: 「来年3月末に満了する賃貸契約」)
4. 賃料改定履歴や敷金、原状回復条件のレポート出力
5. 物件・契約台帳の自動生成

## 3. 対応文書種別(フェーズ1)
- **賃貸借契約書**(建物/土地/区分所有)
- **覚書**(memorandum)
- **更新合意書**(renewal)

### 3.1 将来拡張予定(フェーズ2以降)
- 解約通知
- 重要事項説明書
- 見積/請求書(契約付随)

---

## 4. 画面構成・ユーザーフロー

### 4.1 画面一覧

#### 4.1.1 認証画面
- **ログイン画面**: メールアドレス・パスワードによるログイン
  - 左右2分割レイアウト(ブランディング + ログインフォーム)
  - パスワードリセット機能へのリンク

#### 4.1.2 メイン機能画面
- **ダッシュボード**: 主要機能へのアクセス、簡易カレンダー、未検証契約アラート
  - クイックアクション: 6つの主要機能へのカード型ナビゲーション
  - 契約アラート表示: 未検証契約件数、期限間近の契約件数
  - 最近追加された契約: 最新5件の契約情報
  - 期限間近の契約: 30日以内に満了する契約一覧
  - 簡易カレンダー: 当月の契約期限可視化

- **契約書登録**: PDFアップロード、処理状況管理
  - ドラッグ&ドロップアップロードエリア
  - 契約種別の事前選択(任意)
  - 処理中ファイルの一覧表示
  - リアルタイム処理状況: プログレスバー + ステップ表示
  - ステップ: アップロード → OCR処理 → AI抽出 → 検証
  - 処理完了後の検証画面への遷移

- **契約検索**: タブ切り替え(通常検索 / AI検索)
  - **通常検索タブ**:
    - キーワード検索 + フィルタ検索
    - 自然言語検索オプション
    - 検索結果テーブル表示(ページネーション付き)
    - 詳細表示・CSV/Excel出力機能
  - **AI検索タブ(RAG)**:
    - 自然言語クエリ入力(テキストエリア)
    - よく使う質問例のクイックアクセス
    - AIによる回答生成 + 関連契約一覧
    - 関連度スコア表示(パーセンテージ)
    - 検索履歴管理

- **契約詳細**: 個別契約の詳細情報表示
  - 契約基本情報(契約番号、種別、期間、ステータス)
  - 物件情報(住所、建物名、面積、用途)
  - 当事者情報(貸主・借主情報)
  - 金銭条件(賃料、敷金、共益費等)
  - AI抽出信頼度スコア表示
  - 更新履歴・関連文書リンク

- **レントロール作成**: レポート出力機能
  - 詳細な出力条件設定(期間、ステータス、種別)
  - 出力項目選択(チェックボックス形式)
  - ソート順指定
  - 出力形式選択(Excel/CSV/PDF)
  - プレビュー機能(最初の5件表示)
  - サマリー情報表示(総件数、賃料合計等)
  - テンプレート保存・読込機能

- **AI契約分析**: 対話形式のデータ分析
  - 自然言語による分析リクエスト
  - よく使う質問例のクイックアクセス
  - 統計結果の視覚化(カード表示、テーブル、グラフ)
  - 分析履歴の保存・再利用
  - 結果のエクスポート機能

- **期限管理**: カレンダービューでの期限可視化
  - 月単位カレンダー表示
  - 契約イベントの色分け表示(開始/更新/満了)
  - 日付クリックでイベント詳細表示
  - 今月のイベント一覧(サイドバー)
  - 月移動ナビゲーション

#### 4.1.3 サブ画面
- **AI抽出結果の検証**: 抽出データの確認・修正
  - サイドバイサイド表示(PDF原本 + 抽出フォーム)
  - 信頼度による色分け表示(高/中/低)
  - 項目別編集フォーム
  - 検証完了・承認ボタン

#### 4.1.4 共通UI要素
- **ヘッダー**: アプリケーション名、ダッシュボードリンク、ログアウト
- **サイドバーナビゲーション**:
  - ダッシュボード
  - 契約書登録
  - 契約検索(通常 + AI統合)
  - レントロール作成
  - AI契約分析
  - 期限管理
  - 設定(下部に分離)
- **アクティブ状態表示**: 現在のページをハイライト
- **カラースキーム**: 青系を基調(#1a365d, #3182ce)、赤系をアクセント

### 4.2 画面遷移フロー

```
ログイン
  ↓
ダッシュボード
  │
  ├─→ 契約書登録 → 検証画面 → 契約詳細
  │
  ├─→ 契約検索(通常 / AI) → 契約詳細
  │
  ├─→ レントロール作成 → プレビュー → ダウンロード
  │
  ├─→ AI契約分析 → 分析結果表示
  │
  └─→ 期限管理 → 契約詳細
```

## 5. 機能要件(フェーズ1想定)

### 5.1 文書入力・解析機能

#### 5.1.1 PDFアップロード
- 単一ファイルおよび複数ファイルの一括アップロード対応
- ドラッグ&ドロップまたはファイル選択での入力
- 対応フォーマット: PDF(テキストPDF・画像PDF)
- 最大ファイルサイズ: 1ファイルあたり20MB
- 最大同時アップロード: 10ファイルまで
- 契約種別の事前選択機能(任意、精度向上のため)
- **処理状況の可視化**:
  - ファイル別のリアルタイム進捗表示
  - プログレスバーによるパーセンテージ表示
  - 4ステップ表示: アップロード → OCR → AI抽出 → 検証
  - 各ステップの完了・処理中・待機状態の視覚化
- アップロード履歴管理(アップロード日時、実行ユーザー)

#### 5.1.2 OCR処理
- 画像PDFからの文字認識(日本語・英数字混在対応)
- 認識結果の構造化(段落・表・項目単位)
- 認識精度ログ出力(信頼度スコア)

#### 5.1.3 LLMによる情報抽出
- 契約情報: 契約種別(rental/lease/memorandum/renewal)、開始日、終了日、契約期間、更新条件、解約条件、契約番号 等
- 物件情報: 所在地、地番、地目、面積、用途 等
- 当事者情報: 貸主・借主の氏名／法人名、住所、連絡先
- 金銭条件: 賃料、敷金、礼金、共益費、支払条件、更新料、保証金 等
- 表形式データ(賃料内訳や支払いスケジュール)の抽出
- **信頼度スコア出力**: 各抽出項目に0-100%の信頼度を付与
- **抽出状態管理**:
  - 項目別抽出信頼度(extractionConfidence)
  - 手動検証要否フラグ(needsManualReview)
  - 項目別手動検証状況(manualVerified)
- **検証状態トラッキング**:
  - 契約全体の検証状況(unverified/verified/approved)
  - OCR処理状況の詳細管理(pending/processing/completed/failed/retrying)
  - 処理進捗・再試行回数・エラー詳細の記録

#### 5.1.4 抽出結果の検証・修正UI
- 項目別編集(入力補助付き)
- 元PDFとの対応表示(該当箇所ハイライト)
- **信頼度による色分け表示**: 低信頼度項目(80%未満)を警告色で表示
- **サイドバイサイド表示**: 抽出結果とPDF原本の並列表示
- **該当箇所ジャンプ機能**: 抽出項目クリックでPDF該当箇所に移動
- 修正履歴の記録(ユーザー名・日時・変更内容)

#### 5.1.5 品質保証・検証機能
- **検証フロー**: AI抽出後は「未検証」状態、担当者確認後に「確定」状態
- **検証状態の可視化**: 未確認・確認済みの明確な状態表示

#### 5.1.6 精度改善・学習機能
- **修正履歴の蓄積**:
  - 修正前後の値、修正理由カテゴリ、修正者属性の記録
  - データ形式: JSON形式での構造化ログ
- **精度向上対応**:
  - 修正履歴データの分析に基づく改善点の特定
  - 適切なタイミングでのLLMモデルまたはプロンプトの差し替え
  - 抽出精度の定期的な監視・評価

#### 5.1.7 エラーハンドリング・例外処理
- **OCR処理失敗時**:
  - 画像前処理(回転・コントラスト調整)後の再実行
  - 手動入力モードへの切り替えオプション
  - 処理スキップ・後回し機能
- **LLM API障害時**:
  - 3回の自動リトライ(指数バックオフ)
  - 代替LLMサービスへの自動切り替え
  - 部分処理結果の一時保存・継続機能
- **大容量ファイル処理**:
  - ページ分割処理(10ページ単位)
  - プログレスバー・中断・再開機能
  - タイムアウト設定(15分)・部分結果保存
- **ネットワーク障害時**:
  - ローカル一時保存・オンライン復旧時自動同期
  - オフライン閲覧機能(過去データ)

### 5.2 契約データ管理機能

#### 5.2.1 検索・照会
- **タブ式統合検索インターフェース**:
  - 「通常検索」タブと「AI検索」タブの切り替え
  - 同一画面での2つの検索方法の提供

- **通常検索機能**:
  - 全文キーワード検索
  - 項目別フィルタ(契約種別、期間、ステータス、所在地)
  - 自然言語検索のトグル機能
  - 検索結果テーブル表示(ページネーション付き)
  - 複合条件検索(期間 + 賃料範囲 + 所在地等)
  - CSV/Excel出力機能

- **AI検索機能(RAG)**:
  - 自然言語による質問入力(テキストエリア)
  - よく使う質問例のクイックアクセスボタン
  - AIによる回答生成 + 関連契約一覧の表示
  - 関連度スコアの可視化(パーセンテージ表示、色分け)
  - 検索履歴の保存・管理
  - 質問例:
    - 「来年3月末に満了する賃貸契約を教えて」
    - 「敷金が賃料の3ヶ月分以上の契約はどれですか？」
    - 「渋谷エリアで賃料が50万円以上の物件を探しています」
    - 「自動更新の契約で解約予告期間が3ヶ月以上のものは？」

#### 5.2.2 契約詳細表示機能
- **個別契約詳細画面**: 契約情報の包括的な表示
- **契約基本情報**: 契約番号・種別・期間・ステータス・当事者情報
- **物件詳細情報**: 住所・建物名・面積・用途・部屋番号
- **金銭条件詳細**: 賃料・敷金・管理費等の項目別表示
- **抽出精度表示**: AI抽出の信頼度と手動検証状況
- **更新履歴**: 契約情報の変更履歴・作成日時・更新日時
- **関連文書**: 契約書PDF・関連資料のアクセス

#### 5.2.3 データ更新
- 賃料改定や契約条件変更の登録
- 更新履歴の保持(旧値・新値・更新者)

#### 5.2.4 証跡管理
- 閲覧履歴の記録(ユーザー・日時)
- 編集履歴の記録(ユーザー・日時・変更内容)

### 5.3 期限・アラート管理機能

#### 5.3.1 期限自動検出
- 契約満了日
- 更新期限日
- 解約通知期限日

#### 5.3.2 カレンダー表示機能
- **契約期限のカレンダービュー**: 月単位での期限一覧表示
- **複数イベント表示**: 契約満了・開始・更新期限の色分け表示
- **期限アラート表示**: 30日以内の重要期限をハイライト表示
- **日付別詳細**: 特定日の契約イベント詳細表示
- **ナビゲーション**: 月移動・今日に戻る機能

#### 5.3.3 アラート通知
- **メール送信のみ**対応
- 通知条件の設定(◯日前通知)
- 複数宛先対応(担当者グループ設定)

### 5.4 レポート・帳票出力機能

#### 5.4.1 レントロール作成機能
- **詳細な出力条件設定**:
  - 対象期間指定(開始日・終了日)
  - 契約ステータス選択(有効契約・終了契約・未検証契約)
  - 契約種別選択(賃貸借契約・更新合意書・覚書)
  - 出力項目選択(チェックボックス形式)
  - ソート順指定(契約番号、物件名、賃料等)
- **プレビュー機能**:
  - 最初の5件のプレビュー表示
  - サマリー情報表示(総件数、賃料合計、平均賃料、総面積)
- **出力形式**: Excel(xlsx)、CSV、PDF
- **テンプレート管理**:
  - 出力条件のテンプレート保存
  - 保存済みテンプレートの読込・削除

#### 5.4.2 その他レポート
- 物件台帳
- 契約台帳
- 契約条件一覧表
- 賃料改定履歴レポート

### 5.5 AI契約分析機能

#### 5.5.1 対話形式のデータ分析
- **自然言語による分析リクエスト**:
  - テキストエリアでの質問入力
  - よく使う質問例のクイックアクセス
  - 分析質問例:
    - 「A社がオーナーの物件の、一店舗あたりの賃料平均を計算して」
    - 「2024年に契約した物件の敷金平均は？」
    - 「渋谷エリアの物件の賃料推移を教えて」
    - 「解約予告期間が6ヶ月以上の契約を集計して」

- **分析結果の可視化**:
  - 統計カード表示(対象件数、平均値、合計値等)
  - 詳細データテーブル
  - グラフ・チャート表示
  - 結果のエクスポート機能(CSV/Excel)

- **分析履歴管理**:
  - 過去の分析リストの保存
  - 再実行機能
  - 分析結果の共有機能

### 5.6 ユーザー管理・権限設定

#### 5.6.1 認証
- **メールアドレスとパスワードによるログイン**
- パスワードリセット(メール認証)

#### 5.6.2 権限管理
- ロール別アクセス制御
  - **事務担当者**: 日常的なデータ入力・確認・更新業務
  - **マネージャー・管理者**: 契約全体の把握・期限管理・意思決定
  - **経理担当者**: 金銭条件確認・会計処理
  - **システム管理者**: ユーザー管理・システム設定
- 操作権限(閲覧／編集／承認)

### 5.7 外部連携機能(フェーズ1範囲)
- **通知**: メール送信のみ
- **ファイルストレージ**: S3などのクラウドストレージに契約書PDFを保管
- **認証**: メールアドレス・パスワード方式のみ
- **他システム連携**: 実装なし

---

## 6. 非機能要件

### 6.1 性能要件
- **応答速度**: 画面遷移は2秒以内、検索結果表示は5秒以内
- **OCR処理時間**: A4サイズ1枚あたり30秒以内
- **LLM処理時間**:
  - 簡易契約書(5ページ以内): 30秒-1分以内
  - 複雑契約書(20ページ以内): 2-5分以内
  - 大規模契約書(20ページ超): 5-8分以内
- **同時利用者数**: 最大50ユーザーの同時アクセス対応
- **ファイルサイズ制限**: PDFファイル1件あたり最大20MB
- **一括処理**: 最大10ファイルの同時処理対応

### 6.2 可用性要件
- **稼働率**: 99.0%以上(メンテナンス時間を除く)
- **メンテナンス時間**: 月1回、2時間以内
- **障害復旧時間**: 4時間以内

### 6.3 拡張性要件
- **データ容量**: 契約データ10万件まで対応
- **ファイル保存**: 総容量1TB(PDF原本)まで対応
- **ユーザー数**: 最大200ユーザーまで拡張可能

### 6.4 互換性要件
- **対応ブラウザ**: Chrome 100+, Safari 15+, Edge 100+
- **対応デバイス**: デスクトップPC・ノートPC
- **推奨画面解像度**: 1920x1080以上
- **PDF対応**: PDF 1.4～2.0形式

### 6.5 ユーザビリティ要件
- **操作習得時間**:
  - 基本操作習得: 1-2時間以内
  - 業務習熟(AI結果検証・修正作業): 3-5日以内
  - 段階的トレーニング計画の提供
- **エラーメッセージ**: 日本語での分かりやすいエラー表示
- **ヘルプ機能**: オンラインヘルプ・マニュアル・動画チュートリアル提供
- **ユーザーサポート**: 導入初期3ヶ月間の集中サポート体制

### 6.6 UI・UX要件

#### 6.6.1 デザインシステム
- **カラースキーム**:
  - プライマリカラー: 青系(#1a365d ヘッダー、#3182ce ボタン・アクセント、#2c5282 ホバー)
  - アクセントカラー: 赤系(#e53e3e エラー・期限警告)
  - 背景色: #f8f9fa(ページ背景)、#ffffff(カード背景)
  - ボーダー・区切り: #e2e8f0
- **タイポグラフィ**: システムフォント(-apple-system, BlinkMacSystemFont, Segoe UI)
- **スペーシング**: 8pxベースのスペーシングシステム
- **角丸**: 8pxの統一された角丸(カード、ボタン、入力フォーム)

#### 6.6.2 ログイン画面
- **レイアウト**: 左右2分割デザイン
  - 左側: ブランディングエリア(グラデーション背景、主要機能紹介)
  - 右側: ログインフォーム(白背景、中央配置)
- **インタラクション**: フォーカス時のボーダー色変更、ボタンホバーエフェクト

#### 6.6.3 ダッシュボード
- **クイックアクションカード**:
  - 6つの主要機能へのナビゲーション
  - カード型レイアウト(左ボーダーアクセント)
  - ホバー時のシャドウエフェクト
- **アラート表示**:
  - 未検証契約件数の警告表示(黄色背景)
  - 期限間近の契約アラート(赤色背景)
- **最近の活動**:
  - 最近追加された契約(最新5件)
  - 期限間近の契約(30日以内、最大5件)
  - テーブル形式での一覧表示
- **簡易カレンダー**:
  - 当月のカレンダー表示
  - 契約イベントの日付マーク
  - イベントリスト表示(日付・契約番号・イベント種別)

#### 6.6.4 契約書登録画面
- **アップロードエリア**:
  - ドラッグ&ドロップ対応の大型エリア
  - アイコン + テキストでの視覚的誘導
  - ファイル選択ボタンの代替手段
- **処理状況表示**:
  - ファイル別のカード表示
  - リアルタイムプログレスバー(パーセンテージ表示)
  - 4ステップ表示(アップロード → OCR → AI抽出 → 検証)
  - 色分けステータス(完了: 緑、処理中: 青、待機: グレー)
  - 各ステップの進行状況アイコン(✓/▶/待機)

#### 6.6.5 契約検索画面
- **タブナビゲーション**:
  - 「通常検索」「AI検索」の2つのタブ
  - アクティブタブの下線表示(青)
  - タブ切り替え時のページ遷移
- **通常検索UI**:
  - キーワード検索ボックス + フィルタ(契約種別、期間、ステータス)
  - 自然言語検索のトグルスイッチ
  - 検索結果テーブル(ページネーション付き)
- **AI検索UI**:
  - 大型テキストエリア(複数行入力)
  - プレースホルダーでの例示
  - よく使う質問のクイックボタン
  - AI回答の強調表示(背景色、アイコン)
  - 関連度スコアの可視化(パーセンテージ、色分け)

#### 6.6.6 契約詳細画面
- **情報グループ化**:
  - 基本情報・物件情報・当事者情報・金銭条件のセクション分け
  - 各セクションの明確な見出し
- **ステータス表示**:
  - バッジによる契約ステータス表示(有効/終了/未検証)
  - 色分け(緑/グレー/黄色)
- **信頼度スコア**:
  - 各項目の横にスコア表示
  - 低信頼度項目の警告色表示

#### 6.6.7 レントロール作成画面
- **出力条件設定**:
  - 2カラムグリッドレイアウト
  - チェックボックス・ラジオボタンの視覚的整理
  - 出力項目の3カラムチェックボックスグリッド
- **プレビュー機能**:
  - テーブル形式での最初5件表示
  - 水平スクロール対応(多カラム表示)
- **サマリー情報**:
  - 大型数値カード(総件数、賃料合計、平均賃料、総面積)
  - 4カラムグリッドレイアウト

#### 6.6.8 AI契約分析画面
- **対話インターフェース**:
  - チャット風のUI(質問 + AI回答)
  - 質問入力エリア(テキストエリア)
  - よく使う質問のクイックボタン
- **分析結果表示**:
  - 統計カード(大型数値表示、3カラム)
  - 詳細テーブル(契約一覧)
  - グラフ表示エリア(プレースホルダー)
- **履歴管理**:
  - 過去の分析リスト
  - 再実行ボタン

#### 6.6.9 期限管理画面
- **カレンダー表示**:
  - 月単位のグリッドレイアウト
  - 契約イベントの色分けドット表示(青/緑/赤)
  - 日付ホバー時のツールチップ
- **イベントリスト**:
  - 今月のイベント一覧(サイドバー形式)
  - イベント種別のアイコン表示
  - 契約詳細へのリンク

#### 6.6.10 検証画面
- **サイドバイサイドレイアウト**:
  - 左側: PDF原本表示(埋め込みビューアー)
  - 右側: 抽出データフォーム
- **信頼度可視化**:
  - 高信頼度(80%以上): 緑色ボーダー
  - 中信頼度(50-80%): 黄色ボーダー
  - 低信頼度(50%未満): 赤色ボーダー
- **編集機能**:
  - インライン編集フォーム
  - 修正履歴の自動記録

#### 6.6.11 共通コンポーネント
- **ヘッダー**:
  - ダークブルー背景(#1a365d)
  - 白文字、アプリケーション名、ナビゲーションリンク
  - 固定高さ、全画面幅
- **サイドバー**:
  - 固定幅(240px)、左側配置
  - アクティブ状態の視覚化(背景色、左ボーダー)
  - 下部に設定項目を分離
- **ボタン**:
  - プライマリ: 青背景(#3182ce)、白文字
  - セカンダリ: グレー背景(#718096)、白文字
  - サクセス: 緑背景(#28a745)、白文字
  - ホバーエフェクト: 色の濃淡変化、シャドウ追加
- **カード**:
  - 白背景、軽いシャドウ(0 2px 4px rgba(0,0,0,0.08))
  - 8pxの角丸、適切なパディング(20-24px)
- **フォーム要素**:
  - 入力フィールド: 2pxボーダー(#e2e8f0)、フォーカス時青ボーダー
  - セレクトボックス: 統一されたスタイル
  - チェックボックス・ラジオボタン: ラベルとのセット表示
- **テーブル**:
  - ヘッダー行の背景色(#f8f9fa)
  - 行のホバーエフェクト(背景色変化)
  - ボーダーによる区切り
- **バッジ・ラベル**:
  - 小型、角丸、色分け(ステータスに応じた背景色)
  - 情報: 青、成功: 緑、警告: 黄、エラー: 赤
- **プログレスバー**:
  - グラデーション効果
  - パーセンテージ表示
  - スムーズなアニメーション

#### 6.6.12 レイアウト構造
- **基本レイアウト**:
  - サイドバー(固定幅240px) + メインコンテンツの2カラムレイアウト
  - デスクトップPC・ノートPCでの利用を想定
  - 推奨画面解像度: 1920x1080以上

#### 6.6.13 インタラクション・フィードバック
- **ローディング状態**:
  - プログレスバー、スピナー、スケルトンスクリーン
- **成功・エラーフィードバック**:
  - トースト通知(画面右上)
  - インラインエラーメッセージ(フォーム下)
- **ホバーエフェクト**:
  - カード: シャドウ強化
  - ボタン: 色変化、わずかな浮き上がり
  - リンク: 下線表示、色変化
- **トランジション**:
  - スムーズなアニメーション(0.2-0.3秒)
  - 色変化、サイズ変化、位置移動

---

## 7. セキュリティ要件

### 7.1 認証・認可
- **パスワード強度**(NIST SP 800-63B準拠):
  - 最小12文字以上(推奨15文字以上)
  - 文字構成の強制なし(長いパスフレーズ推奨)
  - 侵害済みパスワードの禁止(HIBP等での照合)
  - 定期変更の強制なし(侵害時のみリセット)
- **JWT認証** (NextAuth.js使用):
  - **Access Token**:
    - 有効期限: 15分
    - 格納場所: HTTPOnly Cookie（XSS対策）
    - ペイロード: ユーザーID、メールアドレス、ロール、companyId
  - **Refresh Token**:
    - 有効期限: 7日
    - 格納場所: データベース（refresh_tokensテーブル）
    - Token Rotation: 使用時に新しいトークンを発行し、古いトークンは無効化
    - 自動更新: Access Token期限切れ時に自動的にRefresh
  - **Token失効**:
    - ログアウト時: Refresh Tokenをデータベースから削除
    - パスワード変更時: すべてのRefresh Tokenを無効化
    - 期限切れトークンの定期削除: 1日1回のバッチ処理
- **セッション管理**: セッションタイムアウト30分（JWT有効期限による制御）
- **ログイン試行制限**: 5回失敗でアカウントロック(15分間)
- **権限管理**: ロール別アクセス制御の厳格な実装
  - USER: 基本的な閲覧・編集
  - MANAGER: 承認・削除権限
  - ACCOUNTANT: 経理情報へのアクセス
  - ADMIN: システム全体の管理権限

### 7.2 データ保護
- **暗号化**:
  - 保存データ: AES-256による暗号化
  - 通信データ: TLS 1.2以上
- **個人情報保護**:
  - 仮名化対象: 氏名・住所・電話番号・メールアドレス
  - 仮名化方法: SHA-256ハッシュ化 + ソルト
  - 匿名化タイミング: レポート出力時・データ分析時
  - 仮名化解除: 権限者のみ・業務必要時に限定
- **データマスキング**:
  - 役割別表示制御:
    - 事務担当者: 個人情報マスク(田中***)
    - マネージャー・管理者: 個人情報フル表示
    - 経理担当者: 金銭情報フル表示・個人情報マスク
  - 画面印刷・PDF出力時もマスキング適用
- **データ削除・ポータビリティ**:
  - 個人データ削除要求への対応手順(30日以内)
  - データエクスポート機能(CSV・JSON形式)

### 7.3 監査・ログ
- **操作ログ**:
  - 記録内容: ユーザーID、操作内容、対象データ、実行日時、IPアドレス、変更理由
  - 保持期間: 6ヶ月(法的要求に応じて延長可能)
  - 改ざん防止: ハッシュ値による整合性チェック・外部ログサーバーへの送信
- **アクセスログ**: システムアクセス履歴の記録(1年保持)
- **セキュリティログ**: 不正アクセス試行の検知・記録

---

## 8. システム構成・技術要件

### 8.1 システムアーキテクチャ
- **構成**: Webアプリケーション(SPA + API)
- **クラウド環境**: AWS/Azure/GCPいずれかを想定
- **データベース**: PostgreSQL/MySQL(関係データベース)
- **ファイルストレージ**: S3互換のオブジェクトストレージ

### 8.2 技術スタック
- **フロントエンド**: Next.js 15+ (App Router) + React 19+ + TypeScript
  - 状態管理: Zustand
  - UI スタイリング: Tailwind CSS
  - フォーム処理: React Hook Form + Zod
  - 日付処理: date-fns
- **バックエンド**: Next.js API Routes + Server Actions
  - ORM: Prisma
  - 認証: NextAuth.js (Auth.js)
  - データベース: PostgreSQL (開発時はSQLite)
- **OCRエンジン**: Amazon Textract/Google Document AI/Azure Form Recognizer
- **LLMサービス**: OpenAI API (GPT-4) / Claude API / Azure OpenAI

### 8.3 インフラ要件
- **サーバー**: マネージドサービス利用(AWS ECS/Lambda等)
- **負荷分散**: ロードバランサー対応
- **監視**: アプリケーション監視・ログ監視
- **バックアップ**: データベース・ファイルの日次バックアップ

---

## 9. 運用・保守要件

### 9.1 運用要件
- **稼働監視**:
  - 自動監視: システム死活・レスポンス時間・エラー率(24時間)
  - 人的対応: 平日9-18時の営業時間内対応
  - エスカレーション: Critical障害は2-4時間以内・High障害は1営業日以内で対応開始
  - 監視項目: CPU・メモリ使用率、API応答時間、データベース接続、外部サービス連携
  - 夜間休日: 翌営業日対応(システム停止等の重大障害時のみ緊急対応)
- **定期メンテナンス**: 月1回、平日夜間または休日実施
- **データバックアップ**: 日次自動バックアップ(30日保持)
- **ログ管理**: システムログ・アプリケーションログの収集・分析

### 9.2 保守要件
- **バグ対応**: 重要度に応じた対応時間(Critical: 1営業日以内、High: 3営業日以内)
- **機能改善**: 半年ごとの機能アップデート
- **セキュリティ更新**: 月次セキュリティパッチ適用
- **技術サポート**: 平日9-17時のユーザーサポート対応(メール・チャット)

### 9.3 インシデント対応要件(個人情報保護法対応)
- **インシデント検知・報告**:
  - 検知から初動報告：1時間以内
  - 速報(監督官庁)：重大事案は3-5営業日以内
  - 確報(監督官庁)：調査完了後30-60日以内
- **対応フロー**:
  1. インシデント検知・分類
  2. 封じ込め・影響範囲特定
  3. 初動報告(社内・必要に応じて外部)
  4. 根本原因分析・対策実施
  5. 確報・再発防止策の報告
- **体制**: インシデント対応チーム設置・連絡先整備


---

## 10. 制約条件・前提条件

### 10.1 制約条件
- **開発期間**: 6ヶ月以内でのリリース
- **規制対応**: 個人情報保護法の遵守
- **既存システム移行**:
  - 既存Excelデータの移行対応必須
  - 移行期間: 2ヶ月間の並行運用期間を設定
  - データクレンジング・標準化作業を含む
  - 移行失敗時の業務継続計画策定必須

### 10.2 前提条件
- **ネットワーク**: インターネット接続環境必須
- **ユーザー環境**: PCでの利用を基本とする
- **データ品質**: 契約書PDFは読み取り可能な品質であること
- **運用体制**: システム管理者1名以上の配置

### 10.3 リスク・課題
- **OCR精度**: 手書き文字や低品質PDFの認識精度問題
- **LLM精度**: 契約書特有の表現に対する抽出精度問題
- **データ移行**: 既存Excelデータの品質・形式統一
- **ユーザー教育**: 新システム操作の習得・定着

---

## 11. 成功基準・評価指標

### 11.1 定量的指標
- **処理精度**:
  - OCR認識率: 85-90%以上(段階的に95%を目指す)
  - LLM抽出精度: 75-85%以上(段階的に90%を目指す)
  - 精度改善計画: 運用開始後6ヶ月で目標達成
- **処理時間短縮**: 従来の手動入力と比較して70%削減(段階的に80%を目指す)
- **システム利用率**:
  - 導入後3ヶ月：対象ユーザーの70%以上が月1回以上利用
  - 導入後6ヶ月：対象ユーザーの90%以上が月1回以上利用
- **エラー発生率**: システムエラー発生率1%以下

### 11.2 定性的指標
- **ユーザー満足度**: アンケート調査で80%以上の満足度
- **業務効率化**: 契約管理業務時間の50%以上削減
- **データ品質向上**: 契約情報の一元化・正確性向上
- **コンプライアンス強化**: 期限管理・履歴管理の徹底
